<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contract Generator</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/document_generator/css/contracts.css">
    <link rel="icon" type="image/x-icon" href="assets/images/weblogo.png">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
</head>

<body>
    <!-- Top Bar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm sticky-top hamburger">
        <div class="container-fluid align-items-center justify-content-start">
            <!-- Hamburger button for mobile -->
            <button class="navbar-toggler d-md-none" type="button" id="sidebarToggle" aria-label="Toggle sidebar">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <!-- Logo -->
            <img id="companyLogo" src="/document_generator/assets/images/weblogo.png" alt="Logo" style="height: 50px; width: auto; margin: 0 10px; padding: 0; cursor:pointer;" onclick="location.reload();" draggable="false">

            <!-- Desktop menu (moved to left side beside logo) -->
            <ul class="nav d-none d-md-flex align-items-center ms-md-1 gap-1">
                <li class="nav-item">
                    <a class="nav-link ps-4" href="#">About</a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle ps-4" href="#" id="contractDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        Contract
                    </a>
                    <ul class="dropdown-menu" aria-labelledby="contractDropdown">
                        <li><a class="dropdown-item" href="contracts.html">Placeholder Link 1</a></li>
                        <!-- Add more contract submenu items here -->
                    </ul>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle ps-4" href="#" id="certDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        Certification
                    </a>
                    <ul class="dropdown-menu" aria-labelledby="certDropdown">
                        <li><a class="dropdown-item" href="#">Placeholder Link 2</a></li>
                        <!-- Add more certification submenu items here -->
                    </ul>
                </li>
                <li class="nav-item">
                    <a class="nav-link ps-4" href="#">Benefits</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link ps-4" href="#">Waiver and Quitclaim</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link ps-4" href="#">HR Info System</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link ps-4" href="#">HR Web Links</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link ps-4" href="#">Templates</a>
                </li>
            </ul>

            <!-- Kebab Menu - Right side -->
            <div class="ms-auto">
                <div class="dropdown">
                    <button class="btn btn-link text-dark p-2" type="button" id="kebabMenu" data-bs-toggle="dropdown" aria-expanded="false" style="text-decoration: none;">
                        <i class="bi bi-three-dots-vertical fs-4"></i>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="kebabMenu">
                        <li>
                            <a class="dropdown-item" href="#" id="fullscreenToggle">
                                <i class="bi bi-fullscreen me-2"></i>
                                <span id="fullscreenText">Enter Fullscreen</span>
                            </a>
                        </li>
                        <li><hr class="dropdown-divider"></li>
                        <li>
                            <a class="dropdown-item text-danger" href="#" id="closeApp">
                                <i class="bi bi-x-circle me-2"></i>
                                Close
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>

    <!-- Sidebar -->
    <nav class="bg-light sidebar d-md-none" id="sidebar">
        <!-- Logo section for mobile -->
        <div class="sidebar-header d-md-none">
            <div class="d-flex align-items-left justify-content-between p-3">
                <span class="navbar-brand mb-0 h5">Contract Generator</span>
                <button type="button" class="btn-close" id="sidebarClose" aria-label="Close sidebar"></button>
            </div>
        </div>
        <div class="pt-3">
            <ul class="nav flex-column">
                <li class="nav-item">
                    <a class="nav-link ps-4" href="#">About</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link ps-4" data-bs-toggle="collapse" href="#sidebarContractMenu" role="button" aria-expanded="false" aria-controls="sidebarContractMenu">
                        Contract <i class="bi bi-caret-down-fill small"></i>
                    </a>
                    <div class="collapse ps-4" id="sidebarContractMenu">
                        <ul class="nav flex-column">
                            <li class="nav-item"><a class="nav-link ps-4" href="contracts.html">Employee Contract</a></li>
                            <!-- Add more contract submenu items here -->
                        </ul>
                    </div>
                </li>
                <li class="nav-item">
                    <a class="nav-link ps-4" data-bs-toggle="collapse" href="#sidebarCertMenu" role="button" aria-expanded="false" aria-controls="sidebarCertMenu">
                        Certification <i class="bi bi-caret-down-fill small"></i>
                    </a>
                    <div class="collapse ps-4" id="sidebarCertMenu">
                        <ul class="nav flex-column">
                            <li class="nav-item"><a class="nav-link ps-4" href="#">Employment Certificate</a></li>
                            <!-- Add more certification submenu items here -->
                        </ul>
                    </div>
                </li>
                <li class="nav-item">
                    <a class="nav-link ps-4" href="#">Benefits</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link ps-4" href="#">Waiver and Quitclaim</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link ps-4" href="#">HR Info System</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link ps-4" href="#">HR Web Links</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link ps-4" href="#">Templates</a>
                </li>
            </ul>
        </div>
    </nav>

    <!-- Sidebar overlay for mobile -->
    <div class="sidebar-overlay d-md-none" id="sidebarOverlay"></div>

    <!-- Main Content -->
    <main class="main-content px-md-4" style="margin-bottom: 10px;">
        <div class="pt-3">
            <!-- <h1>CONTRACTS</h1> -->

            <!-- Employee Contract Form -->
            <div class="card mt-0">
                <div class="card-header">
                    <h3>Employment Contract Form</h3>
                </div>
                <div class="card-body" style="padding-bottom: 6px;">
                    <form id="contractForm">
                        <div class="row">
                            <!-- Left side illustration column -->
                            <div class="col-md-4 mb-3 text-center">
                                <img src="/document_generator/assets/images/weblogo.png" alt="Contract Illustration" class="img-fluid mb-3" style="max-height: 246px;" draggable="false">
                                
                                <!-- Signatory Information -->
                                <div class="text-start">
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label for="signatory-name" class="form-label">Name of Assigned Signatory <span class="text-danger">*</span></label>
                                            <input type="text" class="form-control" id="signatory-name" value="FERNANDO B. PANGANIBAN" style="text-transform: uppercase;" oninput="this.value = this.value.toUpperCase();" required>
                                        </div>
                                    <!-- E-Signature Upload Recommended size: 400 px wide and 100 px high -->
                                    <div class="col-md-6"> 
                                        <label for="signatureInput" class="form-label">E-Signature (PNG/JPG):</label>
                                        <div class="input-group">
                                            <input type="file" id="signatureInput" accept="image/*" class="form-control">
                                            <button type="button" class="btn btn-sm btn-outline-secondary" id="removeSignatureBtn"
                                                data-bs-toggle="tooltip" title="Remove E-Signature">
                                                <i class="bi bi-trash-fill"></i>
                                            </button>
                                        </div>
                                    </div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="signatory-position" class="form-label">Position of Assigned Signatory <span class="text-danger">*</span></label>
                                        <input type="text" class="form-control" id="signatory-position" value="HR & Admin Manager" required>
                                    </div>
                                    
                                    <!-- Weather/Date Widget -->
                                    <div class="card text-white mt-4" style="background-color: #879ed7; border: none;">
                                        <div class="card-body p-2 position-relative">
                                            <h1 class="display-5 mb-0">8:00 AM</h1>
                                            <p class="mb-0">Sunday</p>
                                            <p class="mb-0">October 05, 2025</p>
                                            <div class="position-absolute top-0 end-0 m-2 text-end">
                                                <i id="weatherIcon" class="bi bi-cloud-sun fs-1"></i>
                                                <div class="mt-1">
                                                    <div class="h5 mb-0" id="temperature" style="position: relative; bottom: 12px; font-size: 19px;">--°C</div>
                                                    <small id="location" style="position: relative; bottom: 6px; font-size: small;">Manila, Philippines</small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Right side form fields -->
                            <div class="col-md-8">
                                <div class="row">
                                    <!-- Company Details Section -->
                                    <div class="col-md-6">
                                        <h5>Company Details</h5>
                                        <div class="mb-3">
                                            <label for="company" class="form-label">Company <span class="text-danger">*</span></label>
                                            <select class="form-select" id="company" required>
                                                <option value="">Select Company</option>
                                                <option value="trade-marketing">Trade Marketing Solutions Inc.</option>
                                                <option value="regcris">Regcris Marketing Network</option>
                                                <option value="prestige">Prestige Promotions Inc.</option>
                                            </select>
                                        </div>

                                        <div class="mb-3">
                                            <label for="company-address" class="form-label">Company Address</label>
                                            <textarea class="form-control" id="company-address" rows="2" readonly style="resize: none;"></textarea>
                                        </div>

                                        <div class="mb-3">
                                            <label for="client" class="form-label">Client <span class="text-danger">*</span></label>
                                            <input type="text" class="form-control" id="client" style="text-transform: capitalize;" required>
                                        </div>
                                    </div>

                                    <!-- Employment Details Section -->
                                    <div class="col-md-6">
                                        <h5>Employment Details</h5>
                                        <div class="mb-3">
                                            <label for="start-date" class="form-label">Start Date <span class="text-danger">*</span></label>
                                            <input type="date" class="form-control" id="start-date" required>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <label for="end-date" class="form-label">End Date</label>
                                            <input type="text" class="form-control" id="end-date" readonly>
                                        </div>

                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="salary" class="form-label">Salary <span class="text-danger">*</span></label>
                                                <input type="number" class="form-control" id="salary" step="0.01" placeholder="0.00" required>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="employee-id" class="form-label">Employee ID <span class="text-danger">*</span></label>
                                                <input type="text" class="form-control" id="employee-id" maxlength="17" placeholder="Up to 17 characters" required>
                                            </div>
                                        </div>

                                        <div class="mb-3">
                                            <label for="employment-type" class="form-label">Employment Type <span class="text-danger">*</span></label>
                                            <select class="form-select" id="employment-type" required>
                                                <option value="">Select Type</option>
                                                <option value="PROBATIONARY">Probationary</option>
                                                <option value="CONTRACTUAL">Contractual</option>
                                            </select>
                                        </div>
                                    </div>

                                    <!-- Employee Information Section -->
                                    <div class="col-md-6 mt-3">
                                        <h5>Employee Information</h5>
                                        <div class="mb-3">
                                            <label for="name" class="form-label">Full Name <span class="text-danger">*</span></label>
                                            <input type="text" class="form-control" id="name" style="text-transform: capitalize;" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="address" class="form-label">Address <span class="text-danger">*</span></label>
                                            <input type="text" class="form-control" id="address" style="text-transform: capitalize;" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="position" class="form-label">Position <span class="text-danger">*</span></label>
                                            <input type="text" class="form-control" id="position" placeholder="Enter Position" style="text-transform: capitalize;" required>
                                        </div>
                                    </div>

                                    <!-- Contact Information Section -->
                                    <div class="col-md-6 mt-3">
                                        <h5>Contact Information</h5>
                                        <div class="mb-3">
                                            <label for="email" class="form-label">Email <span class="text-danger">*</span></label>
                                            <input type="email" class="form-control" id="email" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="phone" class="form-label">Phone Number <span class="text-danger">*</span></label>
                                            <div class="input-group">
                                                <span class="input-group-text">+63</span>
                                                <input type="tel" class="form-control" id="phone" pattern="[0-9]{10}" maxlength="10" placeholder="9123456789" oninput="this.value = this.value.replace(/[^0-9]/g, '')" required>
                                            </div>
                                        </div>
                                        <div class="d-flex justify-content-end gap-2" style="padding-top: 2em;">
                                            <button type="button" class="btn btn-outline-danger btn-sm" id="resetConfirmBtn">
                                                <i class="bi bi-arrow-counterclockwise"></i> Reset Form
                                            </button>
                                            <div class="btn-group" role="group" aria-label="Preview and Edit">
                                                <button type="button" class="btn btn-outline-secondary btn-sm" id="editBtn">
                                                    <i class="bi bi-pencil"></i> Edit
                                                </button>
                                                <button type="button" class="btn btn-outline-secondary btn-sm" id="previewBtn" disabled>
                                                    <i class="bi bi-eye"></i> Preview
                                                </button>
                                            </div>
                                            <button type="submit" class="btn btn-primary btn-sm">
                                                <i class="bi bi-file-earmark-plus"></i> Generate Contract
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </main>

    <!-- Reset Confirmation Modal -->
    <div class="modal fade" id="resetConfirmModal" tabindex="-1" aria-labelledby="resetConfirmLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="resetConfirmLabel">Confirm Reset</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    Are you sure you want to reset the form? All entered data will be lost.
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmResetBtn">Yes, Reset</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Close Confirmation Modal -->
    <div class="modal fade" id="closeConfirmModal" tabindex="-1" aria-labelledby="closeConfirmLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="closeConfirmLabel">
                        Confirm Close
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    Are you sure you want to close this page? Any unsaved changes will be lost.
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmCloseBtn">
                        Yes, Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Contract Preview Modal -->
    <div class="modal fade" id="contractPreviewModal" tabindex="-1" aria-labelledby="contractPreviewLabel" aria-hidden="true">
        <div class="modal-dialog modal-fullscreen">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="contractPreviewLabel">Contract Preview</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="contractPreviewBody">
                    <!-- Contract preview will be injected here -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-outline-primary" id="editFromPreviewBtn">
                        <i class="bi bi-pencil"></i> Edit Contract
                    </button>
                    <button type="button" class="btn btn-primary position-relative" id="downloadPdfBtn">
                        <span id="downloadLoader" class="spinner-border spinner-border-sm me-1 d-none" role="status" aria-hidden="true"></span>
                        <i class="bi bi-download me-1"></i> Download PDF
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Contract Text Editor Modal -->
    <div class="modal fade" id="contractEditorModal" tabindex="-1" aria-labelledby="contractEditorLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="contractEditorLabel">Edit Contract Text</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <ul class="nav nav-tabs" id="editorTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="sections-tab" data-bs-toggle="tab" data-bs-target="#sections-content" type="button" role="tab" aria-controls="sections-content" aria-selected="true">Contract Sections</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="acknowledgements-tab" data-bs-toggle="tab" data-bs-target="#acknowledgements-content" type="button" role="tab" aria-controls="acknowledgements-content" aria-selected="false">Acknowledgements</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="kpi-tab" data-bs-toggle="tab" data-bs-target="#kpi-content" type="button" role="tab" aria-controls="kpi-content" aria-selected="false">KPI Sections</button>
                        </li>
                    </ul>
                    
                    <div class="tab-content mt-3" id="editorTabsContent">
                        <!-- Contract Sections Tab -->
                        <div class="tab-pane fade show active" id="sections-content" role="tabpanel" aria-labelledby="sections-tab">
                            <div class="alert alert-info">
                                <i class="bi bi-info-circle"></i> You can use markdown for formatting: **bold text** will appear in bold.
                            </div>
                            <div id="contractSectionsContainer">
                                <!-- Section editors will be added here dynamically -->
                            </div>
                        </div>
                        
                        <!-- Acknowledgements Tab -->
                        <div class="tab-pane fade" id="acknowledgements-content" role="tabpanel" aria-labelledby="acknowledgements-tab">
                            <div id="acknowledgementsContainer">
                                <!-- Acknowledgement editors will be added here dynamically -->
                            </div>
                        </div>
                        
                        <!-- KPI Sections Tab -->
                        <div class="tab-pane fade" id="kpi-content" role="tabpanel" aria-labelledby="kpi-tab">
                            <div id="kpiSectionsContainer">
                                <!-- KPI section editors will be added here dynamically -->
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveContractEdits">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/markdown-it@13.0.1/dist/markdown-it.min.js"></script>
    <script src="/document_generator/js/contracts.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // E-signature close button
            const signatureInput = document.getElementById('signatureInput');
            const removeSignatureBtn = document.getElementById('removeSignatureBtn');
            if (signatureInput && removeSignatureBtn) {
                removeSignatureBtn.addEventListener('click', function () {
                signatureInput.value = '';
                signatureImageDataUrl = null;
                signatureImageLoaded = Promise.resolve();
                });
            }

            // Fullscreen functionality
            const fullscreenToggle = document.getElementById('fullscreenToggle');
            const fullscreenText = document.getElementById('fullscreenText');
            const fullscreenIcon = fullscreenToggle.querySelector('i');

            if (fullscreenToggle) {
                fullscreenToggle.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    if (!document.fullscreenElement) {
                        // Enter fullscreen
                        document.documentElement.requestFullscreen().then(() => {
                            fullscreenText.textContent = 'Exit Fullscreen';
                            fullscreenIcon.className = 'bi bi-fullscreen-exit me-2';
                        }).catch(err => {
                            console.error('Error attempting to enable fullscreen:', err);
                        });
                    } else {
                        // Exit fullscreen
                        document.exitFullscreen().then(() => {
                            fullscreenText.textContent = 'Enter Fullscreen';
                            fullscreenIcon.className = 'bi bi-fullscreen me-2';
                        }).catch(err => {
                            console.error('Error attempting to exit fullscreen:', err);
                        });
                    }
                });

                // Listen for fullscreen changes (e.g., user presses ESC)
                document.addEventListener('fullscreenchange', function() {
                    if (!document.fullscreenElement) {
                        fullscreenText.textContent = 'Enter Fullscreen';
                        fullscreenIcon.className = 'bi bi-fullscreen me-2';
                    }
                });
            }

            // Close app functionality with Bootstrap modal
            const closeApp = document.getElementById('closeApp');
            const closeConfirmModal = new bootstrap.Modal(document.getElementById('closeConfirmModal'));
            const confirmCloseBtn = document.getElementById('confirmCloseBtn');

            if (closeApp) {
                closeApp.addEventListener('click', function(e) {
                    e.preventDefault();
                    closeConfirmModal.show();
                });
            }

            if (confirmCloseBtn) {
                confirmCloseBtn.addEventListener('click', function() {
                    // Try to close the window
                    window.close();
                    
                    // If window.close() doesn't work (most modern browsers block it for security),
                    // redirect to a blank page or homepage
                    setTimeout(function() {
                        window.location.href = 'about:blank';
                    }, 100);
                });
            }

            // Enable/disable Preview button based on form validity
            const contractForm = document.getElementById('contractForm');
            const previewBtn = document.getElementById('previewBtn');

            if (contractForm && previewBtn) {
                contractForm.addEventListener('input', function() {
                    previewBtn.disabled = !contractForm.checkValidity();
                });
            }
            
            // Sidebar toggle functionality
            const sidebarToggle = document.getElementById('sidebarToggle');
            const sidebar = document.getElementById('sidebar');
            const sidebarOverlay = document.getElementById('sidebarOverlay');
            const sidebarClose = document.getElementById('sidebarClose');

            if (sidebarToggle && sidebar && sidebarOverlay) {
                // Toggle sidebar on hamburger click
                sidebarToggle.addEventListener('click', function() {
                    sidebar.classList.toggle('show');
                    sidebarOverlay.classList.toggle('show');
                    document.body.classList.toggle('sidebar-open');
                });

                // Close sidebar when clicking overlay
                sidebarOverlay.addEventListener('click', function() {
                    sidebar.classList.remove('show');
                    sidebarOverlay.classList.remove('show');
                    document.body.classList.remove('sidebar-open');
                });

                // Close sidebar when clicking close button
                if (sidebarClose) {
                    sidebarClose.addEventListener('click', function() {
                        sidebar.classList.remove('show');
                        sidebarOverlay.classList.remove('show');
                        document.body.classList.remove('sidebar-open');
                    });
                }

                // Close sidebar on window resize if screen becomes larger
                window.addEventListener('resize', function() {
                    if (window.innerWidth >= 768) {
                        sidebar.classList.remove('show');
                        sidebarOverlay.classList.remove('show');
                        document.body.classList.remove('sidebar-open');
                    }
                });

                // Close sidebar when pressing Escape key
                document.addEventListener('keydown', function(e) {
                    if (e.key === 'Escape' && sidebar.classList.contains('show')) {
                        sidebar.classList.remove('show');
                        sidebarOverlay.classList.remove('show');
                        document.body.classList.remove('sidebar-open');
                    }
                });
            }

            // Reset confirmation modal logic
            const resetConfirmBtn = document.getElementById('resetConfirmBtn');
            const resetConfirmModal = new bootstrap.Modal(document.getElementById('resetConfirmModal'));
            const confirmResetBtn = document.getElementById('confirmResetBtn');

            if (resetConfirmBtn && confirmResetBtn && contractForm) {
                resetConfirmBtn.addEventListener('click', function(e) {
                    resetConfirmModal.show();
                });

                confirmResetBtn.addEventListener('click', function() {
                    contractForm.reset();
                    document.getElementById('previewBtn').disabled = true;
                    resetConfirmModal.hide();
                });
            }

            // Weather/Date Widget functionality
            function updateDateTimeWidget() {
                // Get widget elements
                const timeElement = document.querySelector('.card .display-5');
                const dayElement = document.querySelector('.card p:nth-of-type(1)');
                const dateElement = document.querySelector('.card p:nth-of-type(2)');
                
                // Get current date and time
                const now = new Date();
                
                // Update time (12-hour format with AM/PM)
                const hours = now.getHours();
                const minutes = now.getMinutes();
                const ampm = hours >= 12 ? 'PM' : 'AM';
                const displayHours = hours % 12 || 12; // Convert 0 to 12 for 12 AM
                timeElement.textContent = `${displayHours}:${minutes.toString().padStart(2, '0')} ${ampm}`;
                
                // Update day of week
                const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
                dayElement.textContent = days[now.getDay()];
                
                // Update date (Month DD, YYYY format)
                const months = ['January', 'February', 'March', 'April', 'May', 'June', 
                               'July', 'August', 'September', 'October', 'November', 'December'];
                const month = months[now.getMonth()];
                const date = now.getDate();
                const year = now.getFullYear();
                dateElement.textContent = `${month} ${date}, ${year}`;
            }
            
            // Initialize date/time widget and update every second
            updateDateTimeWidget();
            setInterval(updateDateTimeWidget, 1000);
            
            // Add weather functionality using Open-Meteo API (completely free, no API key needed)
            function getWeatherData() {
                // Default coordinates for Makati
                let latitude = 14.5576;
                let longitude = 121.0240;
                
                // Try to get user location for more accurate weather
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        // Success callback
                        function(position) {
                            latitude = position.coords.latitude;
                            longitude = position.coords.longitude;
                            fetchWeather(latitude, longitude);
                        },
                        // Error callback
                        function(error) {
                            console.log("Geolocation error:", error);
                            fetchWeather(latitude, longitude); // Use default coordinates
                        },
                        { timeout: 5000 }
                    );
                } else {
                    // Fallback to default location if geolocation not available
                    fetchWeather(latitude, longitude);
                }
            }
            
            // Fetch weather from Open-Meteo API
            function fetchWeather(latitude, longitude) {
                const weatherIcon = document.getElementById('weatherIcon');
                const temperatureElement = document.getElementById('temperature');
                const locationElement = document.getElementById('location');
                
                // Using Open-Meteo API (free, no key required)
                const apiUrl = `https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current=temperature,weather_code&timezone=auto`;
                
                fetch(apiUrl)
                    .then(response => response.json())
                    .then(data => {
                        // Update weather icon based on the weather code
                        updateWeatherIcon(data.current.weather_code, weatherIcon);
                        
                        // Update temperature
                        const temp = Math.round(data.current.temperature);
                        temperatureElement.textContent = `${temp}°C`;
                    })
                    .catch(error => {
                        console.error("Weather API error:", error);
                    });
                
                // Get location name using reverse geocoding
                const geocodeUrl = `https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${latitude}&longitude=${longitude}&localityLanguage=en`;
                
                fetch(geocodeUrl)
                    .then(response => response.json())
                    .then(data => {
                        // Clean up the location data to avoid unwanted text like "(the)"
                        let city = data.city || data.locality || data.principalSubdivision || 'Unknown City';
                        let country = data.countryName || 'Unknown Country';
                        
                        // Remove any parenthetical information from city name
                        city = city.replace(/\s*\([^)]*\)/g, '').trim();
                        country = country.replace(/\s*\([^)]*\)/g, '').trim();
                        
                        locationElement.textContent = `${city}, ${country}`;
                    })
                    .catch(error => {
                        console.error("Geocoding error:", error);
                        locationElement.textContent = "Unknown Location"; // Fallback
                    });
            }
            
            // Update the weather icon based on the WMO weather code
            function updateWeatherIcon(weatherCode, iconElement) {
                // Map WMO weather codes to Bootstrap icons
                // https://open-meteo.com/en/docs#weathervariables
                let iconClass = 'bi-cloud';
                
                // Clear
                if (weatherCode === 0) {
                    iconClass = 'bi-sun';
                }
                // Mainly clear, partly cloudy
                else if (weatherCode >= 1 && weatherCode <= 2) {
                    iconClass = 'bi-cloud-sun';
                }
                // Overcast
                else if (weatherCode === 3) {
                    iconClass = 'bi-clouds';
                }
                // Fog
                else if (weatherCode >= 45 && weatherCode <= 48) {
                    iconClass = 'bi-cloud-fog';
                }
                // Drizzle
                else if (weatherCode >= 51 && weatherCode <= 57) {
                    iconClass = 'bi-cloud-drizzle';
                }
                // Rain
                else if ((weatherCode >= 61 && weatherCode <= 65) || (weatherCode >= 80 && weatherCode <= 82)) {
                    iconClass = 'bi-cloud-rain';
                }
                // Snow
                else if ((weatherCode >= 71 && weatherCode <= 77) || (weatherCode >= 85 && weatherCode <= 86)) {
                    iconClass = 'bi-snow';
                }
                // Thunderstorm
                else if (weatherCode >= 95 && weatherCode <= 99) {
                    iconClass = 'bi-cloud-lightning';
                }
                
                // Update only the icon class, keep existing positioning
                iconElement.className = `bi ${iconClass} fs-1`;
            }
            
            // Initialize weather (updates once when page loads)
            getWeatherData();
        });
    </script>
</body>
</html>
